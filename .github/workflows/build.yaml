name: build
on:
  workflow_dispatch:
  pull_request:
  push:
    branches: [ 'main', 'release/**' ]
jobs:
  test-linux-amd64:
    runs-on: ubuntu-latest
    permissions:
      contents: read # for reading the repository code.
    steps:
      - name: Test suite setup
        uses: fluxcd/gha-workflows/.github/actions/setup-kubernetes@v0.3.0
        with:
          go-version: 1.25.x
      - name: Run tests
        run: make test
      - name: Verify
        run: make verify
      - name: Build container image
        run: |
          make docker-build IMG=ghcr.io/fluxcd/${{ github.event.repository.name }} \
            BUILD_PLATFORMS=linux/amd64 \
            BUILD_ARGS="--load"
